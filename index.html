<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagliFlex - Pianificazione Produzione</title>
    <!-- Collegamento al file CSS esterno -->
    <link rel="stylesheet" href="style.css">
    <!-- Collegamento a Font Awesome per le icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Overlay di Login -->
    <div id="loginOverlay" class="modal-overlay show" role="dialog" aria-modal="true" aria-labelledby="login-title">
        <div class="login-container">
            <h2 id="login-title">Accedi a MagliFlex</h2>
            <div class="form-group">
                <label for="usernameInput">Nome Utente:</label>
                <input type="text" id="usernameInput" placeholder="Inserisci il tuo nome utente" aria-label="Nome Utente" tabindex="0">
            </div>
            <div class="form-group">
                <label for="passwordInput">Password:</label>
                <input type="password" id="passwordInput" placeholder="Inserisci la tua password" aria-label="Password" tabindex="0">
            </div>
            <button class="btn btn-primary login-button" id="loginButton" aria-label="Login" tabindex="0">Login</button>
            <p class="login-info">Inserisci un nome utente qualsiasi per accedere. Esempio: admin/admin, planner/planner, warehouse/warehouse.</p>
        </div>
    </div>

    <div class="container" id="appContent" style="display: none;">
        <div class="top-bar">
            <button class="hamburger-btn" aria-label="Apri menu di navigazione" tabindex="0" onclick="toggleNavMenu()">
                <span class="hamburger-icon"></span>
                <span class="hamburger-icon"></span>
                <span class="hamburger-icon"></span>
            </button>
            <div class="app-title">MagliFlex</div>
            <div class="top-bar-actions">
                <button class="btn btn-icon theme-toggle-btn" onclick="toggleTheme()" aria-label="Cambia tema (chiaro/scuro)" title="Cambia tema">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="btn btn-icon" onclick="openNotificationsModal()" aria-label="Apri notifiche" title="Notifiche">
                    <i class="fas fa-bell"></i>
                    <span id="notificationBadge" class="notification-badge">0</span>
                </button>
                <button class="btn btn-icon" onclick="logoutUser()" aria-label="Logout" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- Menu di Navigazione Laterale -->
        <nav class="nav-menu" id="mainNavMenu">
            <button class="btn nav-btn" data-page-id="dashboard" aria-label="Vai alla Dashboard" tabindex="0"><i class="fas fa-home"></i> Dashboard</button>
            <button class="btn nav-btn" data-page-id="schedule" aria-label="Vai alla Pianificazione e Calendario" tabindex="0"><i class="fas fa-calendar-alt"></i> Pianificazione & Calendario</button>
            <button class="btn nav-btn" data-page-id="planning" aria-label="Vai alla Creazione Lotti di Produzione" tabindex="0"><i class="fas fa-industry"></i> Lotti Produzione</button>
            <button class="btn nav-btn" data-page-id="articles" aria-label="Vai alla Gestione Articoli" tabindex="0"><i class="fas fa-tshirt"></i> Articoli</button>
            <button class="btn nav-btn" data-page-id="rawMaterials" aria-label="Vai alla Gestione Materie Prime" tabindex="0"><i class="fas fa-boxes"></i> Materie Prime</button>
            <button class="btn nav-btn" data-page-id="phases" aria-label="Vai alla Gestione Fasi di Lavorazione" tabindex="0"><i class="fas fa-cogs"></i> Fasi</button>
            <button class="btn nav-btn" data-page-id="machines" aria-label="Vai alla Gestione Macchinari" tabindex="0"><i class="fas fa-robot"></i> Macchinari</button>
            <button class="btn nav-btn" data-page-id="departments" aria-label="Vai alla Gestione Reparti" tabindex="0"><i class="fas fa-building"></i> Reparti</button>
            <button class="btn nav-btn" data-page-id="holidays" aria-label="Vai alla Gestione Giorni Rossi" tabindex="0"><i class="fas fa-calendar-times"></i> Giorni Rossi</button>
            <button class="btn nav-btn" data-page-id="users" aria-label="Vai alla Gestione Utenti" tabindex="0"><i class="fas fa-users-cog"></i> Gestione Utenti</button>
            <div class="nav-menu-footer">
                <button class="btn btn-icon" onclick="exportDataAsJson()" aria-label="Esporta dati" title="Esporta Dati">
                    <i class="fas fa-download"></i> Esporta Dati
                </button>
                <label for="importDataFile" class="btn btn-icon" aria-label="Importa dati" title="Importa Dati">
                    <i class="fas fa-upload"></i> Importa Dati
                    <input type="file" id="importDataFile" accept=".json" style="display: none;">
                </label>
            </div>
        </nav>

        <!-- Contenuto Principale -->
        <main class="content">
            <!-- Dashboard Page -->
            <section id="dashboard" class="page active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="card" id="generalStats">
                        <h3>Statistiche Generali</h3>
                        <p>Caricamento...</p>
                    </div>
                    <div class="card" id="rawMaterialStockSummary">
                        <h3>Riepilogo Scorte Materie Prime</h3>
                        <p>Caricamento...</p>
                    </div>
                    <div class="card" id="machineStats">
                        <h3>Utilizzo Macchinari</h3>
                        <p>Caricamento...</p>
                    </div>
                    <div class="card" id="upcomingDeliveries">
                        <h3>Consegne Imminenti</h3>
                        <p>Caricamento...</p>
                    </div>
                    <div class="card" id="workloadChart">
                        <h3>Carico di Lavoro Settimanale</h3>
                        <p>Caricamento...</p>
                    </div>
                </div>
            </section>

            <!-- Schedule Page -->
            <section id="schedule" class="page">
                <h2>Pianificazione & Calendario</h2>

                <div class="card">
                    <h3>Calendario Consegne</h3>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary" onclick="navigateDeliveryWeek(-7)" aria-label="Settimana Precedente"><i class="fas fa-chevron-left"></i> Prec. Settimana</button>
                        <span id="currentDeliveryWeekRange"></span>
                        <button class="btn btn-secondary" onclick="navigateDeliveryWeek(7)" aria-label="Settimana Successiva">Succ. Settimana <i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="deliverySchedule">
                        <!-- Delivery schedule will be populated here by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3>Calendario Carico di Lavoro Giornaliero</h3>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary" onclick="navigateWorkloadWeek(-7)" aria-label="Settimana Precedente"><i class="fas fa-chevron-left"></i> Prec. Settimana</button>
                        <span id="currentWorkloadWeekRange"></span>
                        <button class="btn btn-secondary" onclick="navigateWorkloadWeek(7)" aria-label="Settimana Successiva">Succ. Settimana <i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="dailyWorkloadCalendar">
                        <!-- Daily workload will be populated here by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3>Lotti di Pianificazione Dettagliati</h3>
                    <div id="planningList" class="data-list">
                        <!-- Detailed planning list will be populated here by JS -->
                    </div>
                </div>
            </section>

            <!-- Planning Page -->
            <section id="planning" class="page">
                <h2>Crea/Modifica Lotto di Produzione</h2>
                <div class="form-section card">
                    <div class="form-group">
                        <label for="planningArticle">Articolo:</label>
                        <select id="planningArticle" aria-label="Seleziona Articolo">
                            <option value="">Seleziona un articolo...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningQuantity">Quantità (pz):</label>
                        <input type="number" id="planningQuantity" min="1" placeholder="Quantità" aria-label="Quantità">
                    </div>
                    <div class="form-group">
                        <label for="planningStartDate">Data Inizio Desiderata:</label>
                        <input type="date" id="planningStartDate" aria-label="Data Inizio Desiderata">
                    </div>
                    <div class="form-group">
                        <label for="planningType">Tipo di Lotto:</label>
                        <select id="planningType" aria-label="Tipo di Lotto">
                            <option value="production">Produzione</option>
                            <option value="sample">Campionatura</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningPriority">Priorità:</label>
                        <select id="planningPriority" aria-label="Priorità">
                            <option value="low">Bassa</option>
                            <option value="medium">Media</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningNotes">Note:</label>
                        <textarea id="planningNotes" placeholder="Note aggiuntive" aria-label="Note aggiuntive"></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="calculateDelivery()" aria-label="Calcola Consegna Stimata"><i class="fas fa-calculator"></i> Calcola Consegna</button>
                    </div>
                    <div id="deliveryResult" class="result-box">
                        <p style="text-align: center; color: var(--text-color);">Seleziona un articolo, quantità e data per calcolare la data di consegna stimata.</p>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="savePlanningBtn" style="display: none;" onclick="savePlanning()" aria-label="Salva Pianificazione"><i class="fas fa-save"></i> Salva Pianificazione</button>
                        <button class="btn btn-danger" id="cancelPlanningBtn" style="display: none;" onclick="resetPlanningForm()" aria-label="Annulla Pianificazione"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>
            </section>

            <!-- Articles Page -->
            <section id="articles" class="page">
                <h2>Gestione Articoli</h2>
                <div class="form-section card">
                    <h3>Dettagli Articolo</h3>
                    <div class="form-group">
                        <label for="articleId">Modifica Articolo Esistente:</label>
                        <select id="articleId" onchange="loadArticleForEdit()" aria-label="Seleziona Articolo da modificare">
                            <option value="new">-- Nuovo Articolo --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleCode">Codice Articolo:</label>
                        <input type="text" id="articleCode" placeholder="Es. ART-001" aria-label="Codice Articolo">
                    </div>
                    <div class="form-group">
                        <label for="articleDescription">Descrizione:</label>
                        <input type="text" id="articleDescription" placeholder="Es. Maglietta Basic Cotone" aria-label="Descrizione Articolo">
                    </div>
                    <div class="form-group">
                        <label for="articleColor">Colore:</label>
                        <input type="text" id="articleColor" placeholder="Es. Bianco" aria-label="Colore Articolo">
                    </div>
                    <div class="form-group">
                        <label for="articleClient">Cliente:</label>
                        <input type="text" id="articleClient" placeholder="Es. Cliente A" aria-label="Cliente Articolo">
                    </div>

                    <h3>Ciclo di Lavorazione</h3>
                    <div id="cycleSteps" class="dynamic-list-container">
                        <!-- Cycle steps will be added here by JS -->
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="addCycleStep()" aria-label="Aggiungi Fase al Ciclo"><i class="fas fa-plus"></i> Aggiungi Fase</button>

                    <h3>Distinta Base (BOM)</h3>
                    <div id="bomItems" class="dynamic-list-container">
                        <!-- BOM items will be added here by JS -->
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="addBomItem()" aria-label="Aggiungi Materia Prima alla Distinta Base"><i class="fas fa-plus"></i> Aggiungi Materia Prima</button>

                    <div class="form-actions">
                        <button class="btn btn-success" id="saveArticleBtn" onclick="saveArticle()" aria-label="Salva Articolo"><i class="fas fa-plus-circle"></i> Aggiungi Articolo</button>
                        <button class="btn btn-danger" id="cancelArticleBtn" style="display: none;" onclick="resetArticleForm()" aria-label="Annulla Modifiche Articolo"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Articoli</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Codice</th>
                                    <th>Descrizione</th>
                                    <th>Colore</th>
                                    <th>Cliente</th>
                                    <th>Ciclo</th>
                                    <th>BOM</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="articlesTable">
                                <!-- Articles will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Raw Materials Page -->
            <section id="rawMaterials" class="page">
                <h2>Gestione Materie Prime e Magazzino</h2>
                <div class="form-section card">
                    <h3>Carico Materie Prime / Aggiorna Scorta</h3>
                    <div class="form-group">
                        <label for="rawMaterialSelect">Materia Prima Esistente:</label>
                        <select id="rawMaterialSelect" onchange="toggleNewRawMaterialInput()" aria-label="Seleziona Materia Prima">
                            <option value="new">-- Aggiungi Nuova Materia Prima --</option>
                        </select>
                    </div>
                    <div class="form-group" id="newRawMaterialNameGroup">
                        <label for="newRawMaterialName">Nome Nuova Materia Prima:</label>
                        <input type="text" id="newRawMaterialName" placeholder="Es. Filato di Cotone" aria-label="Nome Nuova Materia Prima">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialUnit">Unità di Misura:</label>
                        <input type="text" id="rawMaterialUnit" placeholder="Es. kg, pz, m" aria-label="Unità di Misura">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialQuantity">Quantità (Carico):</label>
                        <input type="number" id="rawMaterialQuantity" min="0.01" step="0.01" value="0" aria-label="Quantità Carico">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialLoadDate">Data Carico:</label>
                        <input type="date" id="rawMaterialLoadDate" aria-label="Data Carico">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialBarcode">Riferimento / Barcode:</label>
                        <input type="text" id="rawMaterialBarcode" placeholder="Es. Fornitore X, BARCODE123" onchange="handleBarcodeInput(event)" aria-label="Riferimento o Barcode">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="saveRawMaterialBtn" onclick="addRawMaterialOrStock()" aria-label="Aggiungi o Carica Scorta"><i class="fas fa-plus-circle"></i> Aggiungi/Carica Scorta</button>
                        <button class="btn btn-danger" id="cancelRawMaterialBtn" style="display: none;" onclick="resetRawMaterialForm()" aria-label="Annulla Modifiche Materia Prima"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Scorte Materie Prime</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Scorta Attuale</th>
                                    <th>Unità</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="rawMaterialsStockTable">
                                <!-- Raw materials stock will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Giornale di Magazzino</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Materia Prima</th>
                                    <th>Tipo</th>
                                    <th>Quantità</th>
                                    <th>Stato</th>
                                    <th>Riferimento</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="warehouseJournalTable">
                                <!-- Warehouse journal will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Phases Page -->
            <section id="phases" class="page">
                <h2>Gestione Fasi di Lavorazione</h2>
                <div class="form-section card">
                    <h3>Dettagli Fase</h3>
                    <div class="form-group">
                        <label for="phaseName">Nome Fase:</label>
                        <input type="text" id="phaseName" placeholder="Es. Tessitura, Cucitura" aria-label="Nome Fase">
                    </div>
                    <div class="form-group">
                        <label for="phaseTime">Tempo di Lavorazione (min/pz):</label>
                        <input type="number" id="phaseTime" min="0.1" step="0.1" placeholder="Tempo in minuti per pezzo" aria-label="Tempo di Lavorazione">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="savePhaseBtn" onclick="addPhase()" aria-label="Salva Fase"><i class="fas fa-plus-circle"></i> Aggiungi Fase</button>
                        <button class="btn btn-danger" id="cancelPhaseBtn" style="display: none;" onclick="resetPhaseForm()" aria-label="Annulla Modifiche Fase"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Fasi</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Tempo (min/pz)</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="phasesTable">
                                <!-- Phases will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Machines Page -->
            <section id="machines" class="page">
                <h2>Gestione Macchinari</h2>
                <div class="form-section card">
                    <h3>Dettagli Macchinario</h3>
                    <div class="form-group">
                        <label for="machineName">Nome Macchinario:</label>
                        <input type="text" id="machineName" placeholder="Es. Rettilinea A, Integrale B" aria-label="Nome Macchinario">
                    </div>
                    <div class="form-group">
                        <label for="machineCapacity">Capacità (pz/ora):</label>
                        <input type="number" id="machineCapacity" min="1" placeholder="Pezzi per ora" aria-label="Capacità Macchinario">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="saveMachineBtn" onclick="addMachine()" aria-label="Salva Macchinario"><i class="fas fa-plus-circle"></i> Aggiungi Macchinario</button>
                        <button class="btn btn-danger" id="cancelMachineBtn" style="display: none;" onclick="resetMachineForm()" aria-label="Annulla Modifiche Macchinario"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Macchinari</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Capacità (pz/ora)</th>
                                    <th>Utilizzo Attuale</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="machinesTable">
                                <!-- Machines will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Departments Page -->
            <section id="departments" class="page">
                <h2>Gestione Reparti</h2>
                <div class="form-section card">
                    <h3>Dettagli Reparto</h3>
                    <div class="form-group">
                        <label for="departmentId">Modifica Reparto Esistente:</label>
                        <select id="departmentId" onchange="loadDepartmentForEdit()" aria-label="Seleziona Reparto da modificare">
                            <option value="new">-- Nuovo Reparto --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="departmentName">Nome Reparto:</label>
                        <input type="text" id="departmentName" placeholder="Es. Reparto Tessitura" aria-label="Nome Reparto">
                    </div>
                    <div class="form-group">
                        <label for="departmentMachineTypes">Tipi Macchinari (separati da virgola):</label>
                        <input type="text" id="departmentMachineTypes" placeholder="Es. Rettilinea, Integrale" aria-label="Tipi Macchinari">
                    </div>
                    <div class="form-group">
                        <label for="departmentFinenesses">Finezza (separati da virgola):</label>
                        <input type="text" id="departmentFinenesses" placeholder="Es. 3, 5, 7, 12, 14" aria-label="Finezza Macchinari">
                    </div>
                    <div class="form-group">
                        <label for="departmentPhaseIds">Fasi Associate (seleziona multipli):</label>
                        <select id="departmentPhaseIds" multiple size="5" aria-label="Fasi Associate">
                            <!-- Phases will be populated here by JS -->
                        </select>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="saveDepartmentBtn" onclick="saveDepartment()" aria-label="Salva Reparto"><i class="fas fa-plus-circle"></i> Aggiungi Reparto</button>
                        <button class="btn btn-danger" id="cancelDepartmentBtn" style="display: none;" onclick="resetDepartmentForm()" aria-label="Annulla Modifiche Reparto"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Reparti</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Tipi Macchinari</th>
                                    <th>Finezza</th>
                                    <th>Fasi Associate</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="departmentsTable">
                                <!-- Departments will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Holidays Page (New Section) -->
            <section id="holidays" class="page">
                <h2>Gestione Giorni Rossi (Festività/Ferie)</h2>
                <div class="form-section card">
                    <h3>Aggiungi/Modifica Giorno Rosso</h3>
                    <div class="form-group">
                        <label for="holidayDate">Data:</label>
                        <input type="date" id="holidayDate" aria-label="Data Giorno Rosso">
                    </div>
                    <div class="form-group">
                        <label for="holidayDescription">Descrizione:</label>
                        <input type="text" id="holidayDescription" placeholder="Es. Natale, Ferragosto, Ferie Aziendali" aria-label="Descrizione Giorno Rosso">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="saveHolidayBtn" onclick="addHoliday()" aria-label="Salva Giorno Rosso"><i class="fas fa-plus-circle"></i> Aggiungi Giorno Rosso</button>
                        <button class="btn btn-danger" id="cancelHolidayBtn" style="display: none;" onclick="resetHolidayForm()" aria-label="Annulla Modifiche Giorno Rosso"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Giorni Rossi</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descrizione</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="holidaysTableBody">
                                <!-- Holidays will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- User Management Page -->
            <section id="users" class="page">
                <h2>Gestione Utenti</h2>
                <div class="form-section card">
                    <h3>Dettagli Utente</h3>
                    <div class="form-group">
                        <label for="usernameInputForm">Nome Utente:</label>
                        <input type="text" id="usernameInputForm" placeholder="Nome utente" aria-label="Nome Utente">
                    </div>
                    <div class="form-group">
                        <label for="passwordInputForm">Password (lascia vuoto per non cambiare):</label>
                        <input type="password" id="passwordInputForm" placeholder="Password" aria-label="Password">
                    </div>
                    <div class="form-group">
                        <label>Ruoli:</label>
                        <div id="userRolesCheckboxes" class="checkbox-group">
                            <label><input type="checkbox" value="admin"> Amministratore</label>
                            <label><input type="checkbox" value="planning"> Pianificazione</label>
                            <label><input type="checkbox" value="warehouse"> Magazzino</label>
                        </div>
                    </div>
                    <div class="form-group checkbox-group">
                        <label><input type="checkbox" id="forcePasswordChangeCheckbox"> Forza cambio password al prossimo accesso</label>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" id="saveUserBtn" onclick="saveUser()" aria-label="Salva Utente"><i class="fas fa-plus-circle"></i> Aggiungi Utente</button>
                        <button class="btn btn-danger" id="cancelUserBtn" style="display: none;" onclick="resetUserForm()" aria-label="Annulla Modifiche Utente"><i class="fas fa-times"></i> Annulla</button>
                    </div>
                </div>

                <div class="table-section card">
                    <h3>Elenco Utenti</h3>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome Utente</th>
                                    <th>Password</th>
                                    <th>Ruoli</th>
                                    <th>Forza Cambio Password</th>
                                    <th>Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be populated here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal per Modifica Lotto di Pianificazione -->
    <div id="editPlanningModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="edit-planning-modal-title">
        <div class="modal-content">
            <h3 id="edit-planning-modal-title">Modifica Lotto di Pianificazione</h3>
            <input type="hidden" id="editPlanningLotId">
            <div class="form-group">
                <label for="editPlanningArticle">Articolo:</label>
                <select id="editPlanningArticle" aria-label="Seleziona Articolo per modifica">
                    <!-- Populated by JS -->
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningQuantity">Quantità (pz):</label>
                <input type="number" id="editPlanningQuantity" min="1" aria-label="Quantità per modifica">
            </div>
            <div class="form-group">
                <label for="editPlanningType">Tipo di Lotto:</label>
                <select id="editPlanningType" aria-label="Tipo di Lotto per modifica">
                    <option value="production">Produzione</option>
                    <option value="sample">Campionatura</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningPriority">Priorità:</label>
                <select id="editPlanningPriority" aria-label="Priorità per modifica">
                    <option value="low">Bassa</option>
                    <option value="medium">Media</option>
                    <option value="high">Alta</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningStartDate">Data Inizio Desiderata:</label>
                <input type="date" id="editPlanningStartDate" aria-label="Data Inizio per modifica">
            </div>
            <div class="form-group">
                <label for="editPlanningNotes">Note:</label>
                <textarea id="editPlanningNotes" aria-label="Note per modifica"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="saveEditedPlanningBtn" aria-label="Salva modifiche al lotto di pianificazione" tabindex="0">Salva Modifiche</button>
                <button class="btn btn-danger" id="cancelEditPlanningBtn" aria-label="Annulla modifiche al lotto di pianificazione" tabindex="0">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Modal per Notifiche -->
    <div id="notificationsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="notifications-modal-title">
        <div class="modal-content">
            <h4 id="notifications-modal-title">Archivio Notifiche</h4>
            <div class="notification-filter-buttons">
                <button id="filterUnread" class="active" onclick="filterNotifications('unread')" aria-label="Mostra solo notifiche non lette" tabindex="0">Non Letti</button>
                <button id="filterAll" onclick="filterNotifications('all')" aria-label="Mostra tutte le notifiche" tabindex="0">Tutti</button>
            </div>
            <div id="notificationsList" role="log" aria-live="polite" aria-atomic="false">
                <p style="text-align: center; color: #888;">Nessun messaggio.</p>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeNotificationsModal()" aria-label="Chiudi archivio notifiche" tabindex="0">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- Modal per Cambio Password Forzato -->
    <div id="changePasswordModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="change-password-modal-title">
        <div class="modal-content">
            <h3 id="change-password-modal-title">Cambia Password</h3>
            <p>La tua password temporanea è stata impostata. Per favore, cambiala ora.</p>
            <div class="form-group">
                <label for="oldPasswordChange">Vecchia Password:</label>
                <input type="password" id="oldPasswordChange" aria-label="Vecchia Password" tabindex="0">
            </div>
            <div class="form-group">
                <label for="newPasswordChange">Nuova Password:</label>
                <input type="password" id="newPasswordChange" aria-label="Nuova Password" tabindex="0">
            </div>
            <div class="form-group">
                <label for="confirmNewPasswordChange">Conferma Nuova Password:</label>
                <input type="password" id="confirmNewPasswordChange" aria-label="Conferma Nuova Password" tabindex="0">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="confirmChangePasswordBtn" aria-label="Conferma cambio password" tabindex="0">Cambia Password</button>
                <button class="btn btn-danger" onclick="closeChangePasswordModal()" aria-label="Annulla cambio password" tabindex="0">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Modal per Registrazione Consumo Effettivo -->
    <div id="actualConsumptionModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="actual-consumption-modal-title">
        <div class="modal-content">
            <h3 id="actual-consumption-modal-title">Registra Consumo Effettivo</h3>
            <p id="modalRmInfo">Caricamento informazioni materia prima...</p>
            <div class="form-group">
                <label for="actualConsumedQuantity">Quantità Effettivamente Consumata:</label>
                <input type="number" id="actualConsumedQuantity" min="0.01" step="0.01" aria-label="Quantità Effettivamente Consumata" tabindex="0">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="confirmActualConsumptionBtn" aria-label="Conferma consumo effettivo" tabindex="0">Conferma Consumo</button>
                <button class="btn btn-danger" id="cancelActualConsumptionBtn" aria-label="Annulla consumo effettivo" tabindex="0">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Custom Message Box Modal -->
    <div id="messageBoxModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="message-box-title">
        <div class="modal-content">
            <h3 id="message-box-title"></h3>
            <p id="message-box-text"></p>
            <div class="modal-buttons" id="message-box-buttons">
                <!-- Buttons will be populated by JS -->
            </div>
        </div>
    </div>


    <!-- Contenitore per le notifiche Toast -->
    <div id="notificationContainer"></div>

    <!-- Collegamento al file JavaScript esterno -->
    <script src="app.js"></script>
</body>
</html>
